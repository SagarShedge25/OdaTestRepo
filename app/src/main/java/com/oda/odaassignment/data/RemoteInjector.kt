package com.oda.odaassignment.data

import okhttp3.*
import okhttp3.MediaType.Companion.toMediaTypeOrNull
import okhttp3.ResponseBody.Companion.toResponseBody
import okhttp3.logging.HttpLoggingInterceptor
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/**Created by srshe on 18-February-2022**/
object RemoteInjector  {

    const val API_ENDPOINT = "https://www.oda.no/v2/"

    fun injectComponentApiService(retrofit: Retrofit = getRetrofit()): ComponentApiService {
        return retrofit.create(ComponentApiService::class.java)
    }

    private fun getRetrofit(okHttpClient: OkHttpClient = getOkHttpClient()): Retrofit {
        return Retrofit.Builder()
            .baseUrl(API_ENDPOINT)
            .addConverterFactory(GsonConverterFactory.create())
            .client(okHttpClient)
            .build()
    }

    private fun getOkHttpMockNetworkInterceptor(): Interceptor {
        return object : Interceptor {
            override fun intercept(chain: Interceptor.Chain): Response {
                val uri = chain.request().url.toUri().toString()
                val responseStringJson = when {
                    uri.endsWith("getResponseJson") -> responseString
                    else -> ""
                }
                return chain.proceed(chain.request())
                    .newBuilder()
                    .code(200)
                    .protocol(Protocol.HTTP_2)
                    .message(responseStringJson)
                    .body(
                        responseStringJson.toByteArray()
                            .toResponseBody("application/json".toMediaTypeOrNull())
                    )
                    .addHeader("content-type", "application/json")
                    .build()
            }
        }
    }

    private fun getHttpLogger(): HttpLoggingInterceptor {
        return HttpLoggingInterceptor().apply {
            level = HttpLoggingInterceptor.Level.BODY
        }
    }

    private fun getOkHttpClient(
        okHttpLogger: HttpLoggingInterceptor = getHttpLogger(),
        okHttpMockNetworkInterceptor: Interceptor = getOkHttpMockNetworkInterceptor()
    ): OkHttpClient {
        return OkHttpClient.Builder()
            .addInterceptor(okHttpLogger)
            .addInterceptor(okHttpMockNetworkInterceptor)
            .build()
    }

    const val responseString = """
        {"blocks":[{"id":"main-header","component":"header","title":"Hei Gabor! Hvor og n\u00e5r vil du ha varene levert?","button":{"title":"Velg levering","target":{"method":"modal","title":"Velg leveringsadresse","uri":"https://oda.com/no/account/complete-profile/select-address/"}}},{"id":"product-list-featured-products","component":"list","title":"Gode kj\u00f8p n\u00e5","tracking_properties":{"location":"Home","list_name":"Featured Products"},"products":[{"id":27046,"full_name":"Ekstra Saftige Klementiner Med Blader, Spania","brand":null,"brand_id":null,"name":"Ekstra Saftige Klementiner","name_extra":"Med Blader, Spania, 900 g","front_url":"https://oda.com/no/products/27046-ekstra-saftige-klementiner-med-blader-spania/","absolute_url":"/no/products/27046-ekstra-saftige-klementiner-med-blader-spania/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/produkter/0cd963be-0a83-4f59-befe-b917b9a38426.jpg?fit=max&w=300&s=755025c162656f63cfcfa58d443242b5"},"large":{"url":"https://bilder.kolonial.no/produkter/0cd963be-0a83-4f59-befe-b917b9a38426.jpg?fit=max&w=1000&s=f026304b78c2ac1b118dfd181caf726b"}}],"gross_price":"42.90","gross_unit_price":"47.67","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":null,"promotion":null,"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]},{"id":28065,"full_name":"R\u00f8de Juleepler Red Delicious Italia","brand":null,"brand_id":null,"name":"R\u00f8de Juleepler Red Delicious","name_extra":"Italia, 4 stk","front_url":"https://oda.com/no/products/28065-rode-juleepler-red-delicious-italia/","absolute_url":"/no/products/28065-rode-juleepler-red-delicious-italia/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/produkter/38260117-6b8d-4ade-b08d-a837a8b37507.jpg?fit=max&w=251&s=4227dfff14b5946898a8c142f7e262ea"},"large":{"url":"https://bilder.kolonial.no/produkter/38260117-6b8d-4ade-b08d-a837a8b37507.jpg?fit=max&w=836&s=82ce1a013f9ad15036ea0cc54ece7d0d"}}],"gross_price":"34.90","gross_unit_price":"46.53","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":null,"promotion":null,"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]},{"id":16621,"full_name":"Buer Birgers Beste Lefser","brand":"Buer","brand_id":952,"name":"Birgers Beste Lefser","name_extra":"5 stk","front_url":"https://oda.com/no/products/16621-buer-birgers-beste-lefser/","absolute_url":"/no/products/16621-buer-birgers-beste-lefser/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/local_products/c476fb6f-acdb-4fd3-ad0a-cda699d35368.jpeg?fit=max&w=300&s=dd8154bfca058a89e6c441021c3d6f65"},"large":{"url":"https://bilder.kolonial.no/local_products/c476fb6f-acdb-4fd3-ad0a-cda699d35368.jpeg?fit=max&w=376&s=7e3a47f751e9c8436001c96a21b491bd"}}],"gross_price":"34.20","gross_unit_price":"171.00","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":null,"promotion":null,"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[{"name":"Holdbarhetsgaranti i 3 dager","image_url":"https://oda.com/static/products/img/expiry-3-20x20@3x.b2649eefb5d1.png","is_important":true},{"name":"Nyt Norge","image_url":"https://oda.com/static/products/img/nytnorge53x60.aac84641427c.png","is_important":false}]},{"id":27551,"full_name":"Freia Japp Smakfull Pean\u00f8tt og Karamell","brand":"Freia","brand_id":51,"name":"Japp Smakfull Pean\u00f8tt og Karamell","name_extra":"276 g","front_url":"https://oda.com/no/products/27551-freia-japp-smakfull-peanott-og-karamell/","absolute_url":"/no/products/27551-freia-japp-smakfull-peanott-og-karamell/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/produkter/e595404f-9906-418a-9662-283053c51d3a.jpeg?fit=max&w=300&s=39cdfd5d91a83398ae978d21f25ba89f"},"large":{"url":"https://bilder.kolonial.no/produkter/e595404f-9906-418a-9662-283053c51d3a.jpeg?fit=max&w=1000&s=a3455e68a15049c7be75a18cad789327"}}],"gross_price":"67.70","gross_unit_price":"245.29","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":{"is_discounted":true,"undiscounted_gross_price":"67.70","undiscounted_gross_unit_price":"245.29","description_short":"Salg!","maximum_quantity":null,"remaining_quantity":null},"promotion":{"title":"4 for 3","title_color":"FFFFFF","background_color":"7332B4","text_color":"7332B4","description_short":"Velg fritt 4 for 3","accessibility_text":"Salg: Velg fritt 4 for 3","display_style":"mix_and_match"},"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]},{"id":25891,"full_name":"Freia Oreo Smakfull","brand":"Freia","brand_id":51,"name":"Oreo Smakfull","name_extra":"320 g","front_url":"https://oda.com/no/products/25891-freia-oreo-smakfull/","absolute_url":"/no/products/25891-freia-oreo-smakfull/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/local_products/afda3d70-ce71-457a-b39d-823146bebee3.jpeg?fit=max&w=300&s=ca33142d8ed850f7a91ce346e2c6b3b4"},"large":{"url":"https://bilder.kolonial.no/local_products/afda3d70-ce71-457a-b39d-823146bebee3.jpeg?fit=max&w=376&s=6ccbe9932a5a21cc2f7ea9cf3e7efc02"}}],"gross_price":"69.10","gross_unit_price":"215.94","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":{"is_discounted":true,"undiscounted_gross_price":"69.10","undiscounted_gross_unit_price":"215.94","description_short":"Salg!","maximum_quantity":null,"remaining_quantity":null},"promotion":{"title":"4 for 3","title_color":"FFFFFF","background_color":"7332B4","text_color":"7332B4","description_short":"Velg fritt 4 for 3","accessibility_text":"Salg: Velg fritt 4 for 3","display_style":"mix_and_match"},"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]},{"id":36441,"full_name":"Lindor Lindor Gaveeske Melkesjokolade","brand":"Lindor","brand_id":1970,"name":"Lindor Gaveeske Melkesjokolade","name_extra":"287 g","front_url":"https://oda.com/no/products/36441-lindor-lindor-gaveeske-melkesjokolade/","absolute_url":"/no/products/36441-lindor-lindor-gaveeske-melkesjokolade/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/local_products/0c3e2210-30fb-4617-a5d9-e3bd8b915ebe.jpeg?fit=max&w=285&s=1d608ceb3d9362bf571254fb131c1fe9"},"large":{"url":"https://bilder.kolonial.no/local_products/0c3e2210-30fb-4617-a5d9-e3bd8b915ebe.jpeg?fit=max&w=357&s=0076439196feeaa4c98e0f0662ea9cb7"}}],"gross_price":"149.18","gross_unit_price":"519.79","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":{"is_discounted":true,"undiscounted_gross_price":"198.90","undiscounted_gross_unit_price":"693.03","description_short":"-25%","maximum_quantity":null,"remaining_quantity":null},"promotion":{"title":"Salg!","title_color":"FFFFFF","background_color":"E61700","text_color":"E61700","description_short":"Salg! -25%","accessibility_text":"Salg! -25%","display_style":"regular_discount"},"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]}]}]}
"""
    const val responseStrings = """
        {"blocks":[{"id":"main-header","component":"header","title":"Hei Gabor! Hvor og n\u00e5r vil du ha varene levert?","button":{"title":"Velg levering","target":{"method":"modal","title":"Velg leveringsadresse","uri":"https://oda.com/no/account/complete-profile/select-address/"}}},{"id":"product-list-featured-products","component":"new","title":"Gode kj\u00f8p n\u00e5","tracking_properties":{"location":"Home","list_name":"Featured Products"},"products":[{"id":27046,"full_name":"Ekstra Saftige Klementiner Med Blader, Spania","brand":null,"brand_id":null,"name":"Ekstra Saftige Klementiner","name_extra":"Med Blader, Spania, 900 g","front_url":"https://oda.com/no/products/27046-ekstra-saftige-klementiner-med-blader-spania/","absolute_url":"/no/products/27046-ekstra-saftige-klementiner-med-blader-spania/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/produkter/0cd963be-0a83-4f59-befe-b917b9a38426.jpg?fit=max&w=300&s=755025c162656f63cfcfa58d443242b5"},"large":{"url":"https://bilder.kolonial.no/produkter/0cd963be-0a83-4f59-befe-b917b9a38426.jpg?fit=max&w=1000&s=f026304b78c2ac1b118dfd181caf726b"}}],"gross_price":"42.90","gross_unit_price":"47.67","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":null,"promotion":null,"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]},{"id":28065,"full_name":"R\u00f8de Juleepler Red Delicious Italia","brand":null,"brand_id":null,"name":"R\u00f8de Juleepler Red Delicious","name_extra":"Italia, 4 stk","front_url":"https://oda.com/no/products/28065-rode-juleepler-red-delicious-italia/","absolute_url":"/no/products/28065-rode-juleepler-red-delicious-italia/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/produkter/38260117-6b8d-4ade-b08d-a837a8b37507.jpg?fit=max&w=251&s=4227dfff14b5946898a8c142f7e262ea"},"large":{"url":"https://bilder.kolonial.no/produkter/38260117-6b8d-4ade-b08d-a837a8b37507.jpg?fit=max&w=836&s=82ce1a013f9ad15036ea0cc54ece7d0d"}}],"gross_price":"34.90","gross_unit_price":"46.53","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":null,"promotion":null,"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]},{"id":16621,"full_name":"Buer Birgers Beste Lefser","brand":"Buer","brand_id":952,"name":"Birgers Beste Lefser","name_extra":"5 stk","front_url":"https://oda.com/no/products/16621-buer-birgers-beste-lefser/","absolute_url":"/no/products/16621-buer-birgers-beste-lefser/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/local_products/c476fb6f-acdb-4fd3-ad0a-cda699d35368.jpeg?fit=max&w=300&s=dd8154bfca058a89e6c441021c3d6f65"},"large":{"url":"https://bilder.kolonial.no/local_products/c476fb6f-acdb-4fd3-ad0a-cda699d35368.jpeg?fit=max&w=376&s=7e3a47f751e9c8436001c96a21b491bd"}}],"gross_price":"34.20","gross_unit_price":"171.00","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":null,"promotion":null,"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[{"name":"Holdbarhetsgaranti i 3 dager","image_url":"https://oda.com/static/products/img/expiry-3-20x20@3x.b2649eefb5d1.png","is_important":true},{"name":"Nyt Norge","image_url":"https://oda.com/static/products/img/nytnorge53x60.aac84641427c.png","is_important":false}]},{"id":27551,"full_name":"Freia Japp Smakfull Pean\u00f8tt og Karamell","brand":"Freia","brand_id":51,"name":"Japp Smakfull Pean\u00f8tt og Karamell","name_extra":"276 g","front_url":"https://oda.com/no/products/27551-freia-japp-smakfull-peanott-og-karamell/","absolute_url":"/no/products/27551-freia-japp-smakfull-peanott-og-karamell/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/produkter/e595404f-9906-418a-9662-283053c51d3a.jpeg?fit=max&w=300&s=39cdfd5d91a83398ae978d21f25ba89f"},"large":{"url":"https://bilder.kolonial.no/produkter/e595404f-9906-418a-9662-283053c51d3a.jpeg?fit=max&w=1000&s=a3455e68a15049c7be75a18cad789327"}}],"gross_price":"67.70","gross_unit_price":"245.29","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":{"is_discounted":true,"undiscounted_gross_price":"67.70","undiscounted_gross_unit_price":"245.29","description_short":"Salg!","maximum_quantity":null,"remaining_quantity":null},"promotion":{"title":"4 for 3","title_color":"FFFFFF","background_color":"7332B4","text_color":"7332B4","description_short":"Velg fritt 4 for 3","accessibility_text":"Salg: Velg fritt 4 for 3","display_style":"mix_and_match"},"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]},{"id":25891,"full_name":"Freia Oreo Smakfull","brand":"Freia","brand_id":51,"name":"Oreo Smakfull","name_extra":"320 g","front_url":"https://oda.com/no/products/25891-freia-oreo-smakfull/","absolute_url":"/no/products/25891-freia-oreo-smakfull/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/local_products/afda3d70-ce71-457a-b39d-823146bebee3.jpeg?fit=max&w=300&s=ca33142d8ed850f7a91ce346e2c6b3b4"},"large":{"url":"https://bilder.kolonial.no/local_products/afda3d70-ce71-457a-b39d-823146bebee3.jpeg?fit=max&w=376&s=6ccbe9932a5a21cc2f7ea9cf3e7efc02"}}],"gross_price":"69.10","gross_unit_price":"215.94","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":{"is_discounted":true,"undiscounted_gross_price":"69.10","undiscounted_gross_unit_price":"215.94","description_short":"Salg!","maximum_quantity":null,"remaining_quantity":null},"promotion":{"title":"4 for 3","title_color":"FFFFFF","background_color":"7332B4","text_color":"7332B4","description_short":"Velg fritt 4 for 3","accessibility_text":"Salg: Velg fritt 4 for 3","display_style":"mix_and_match"},"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]},{"id":36441,"full_name":"Lindor Lindor Gaveeske Melkesjokolade","brand":"Lindor","brand_id":1970,"name":"Lindor Gaveeske Melkesjokolade","name_extra":"287 g","front_url":"https://oda.com/no/products/36441-lindor-lindor-gaveeske-melkesjokolade/","absolute_url":"/no/products/36441-lindor-lindor-gaveeske-melkesjokolade/","images":[{"thumbnail":{"url":"https://bilder.kolonial.no/local_products/0c3e2210-30fb-4617-a5d9-e3bd8b915ebe.jpeg?fit=max&w=285&s=1d608ceb3d9362bf571254fb131c1fe9"},"large":{"url":"https://bilder.kolonial.no/local_products/0c3e2210-30fb-4617-a5d9-e3bd8b915ebe.jpeg?fit=max&w=357&s=0076439196feeaa4c98e0f0662ea9cb7"}}],"gross_price":"149.18","gross_unit_price":"519.79","unit_price_quantity_abbreviation":"kg","unit_price_quantity_name":"Kilogram","currency":"NOK","discount":{"is_discounted":true,"undiscounted_gross_price":"198.90","undiscounted_gross_unit_price":"693.03","description_short":"-25%","maximum_quantity":null,"remaining_quantity":null},"promotion":{"title":"Salg!","title_color":"FFFFFF","background_color":"E61700","text_color":"E61700","description_short":"Salg! -25%","accessibility_text":"Salg! -25%","display_style":"regular_discount"},"availability":{"is_available":true,"code":"available","description":"","description_short":""},"client_classifiers":[]}]}]}
"""
}